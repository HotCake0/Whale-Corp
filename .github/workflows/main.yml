name: ê³ ë˜ìƒì‚¬ ë°©ì†¡ ì•Œë¦¼ ìë™í™”

on:
  push:
    branches: [ "main" ]
  schedule:
    - cron: '*/5 * * * *' # 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

permissions:
  contents: write # ë´‡ì´ íŒŒì¼ì„ ì“°ê³  ì €ì¥í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ

jobs:
  update-stream-info:
    runs-on: ubuntu-latest
    
    steps:
    - name: ì½”ë“œ ë‚´ë ¤ë°›ê¸°
      uses: actions/checkout@v3

    - name: íŒŒì´ì¬ ì„¤ì¹˜
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: |
        pip install requests

    - name: í¬ë¡¤ë§ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      env: # [ì¤‘ìš”] 1ë‹¨ê³„ì—ì„œ ë§Œë“  ë¹„ë°€í‚¤ë¥¼ ì—¬ê¸°ì„œ íŒŒì´ì¬ì— ì „ë‹¬í•©ë‹ˆë‹¤.
        SOOP_CLIENT_ID: ${{ secrets.SOOP_CLIENT_ID }}
        SOOP_CLIENT_SECRET: ${{ secrets.SOOP_CLIENT_SECRET }}
      run: python update_data.py

    - name: ê²°ê³¼ íŒŒì¼ ì €ì¥ ë° ì—…ë¡œë“œ (Commit & Push)
      run: |
        git config --global user.name "GoraeBot"
        git config --global user.email "bot@gorae.com"
        git add streamer_data.json
        # ë³€ê²½ì‚¬í•­ì´ ì—†ìœ¼ë©´ ì—ëŸ¬ ì—†ì´ ì¢…ë£Œ, ìˆìœ¼ë©´ ì»¤ë°‹
        git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ“º ë°©ì†¡ ìƒíƒœ ì—…ë°ì´íŠ¸" && git push)
