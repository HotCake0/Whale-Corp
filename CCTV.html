<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ë˜ìƒì‚¬ ë©€í‹°ë·° - LIVE ì „ìš©</title>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --card-bg: #1e1e1e;
            --accent-color: #00ffa3;
            --text-color: #ffffff;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* ë°©ì†¡ ì¤‘ì¸ ë©¤ë²„ ì„ íƒ ë°” */
        #live-selector {
            background-color: var(--card-bg);
            padding: 10px 20px;
            display: flex;
            gap: 12px;
            overflow-x: auto;
            border-bottom: 2px solid #333;
            align-items: center;
            min-height: 80px;
        }

        .member-card {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #2a2a2a;
            padding: 5px 12px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.2s;
            white-space: nowrap;
        }

        .member-card:hover { background: #333; }
        .member-card.active { border-color: var(--accent-color); background: #1a3a2a; }

        .thumb-mini {
            width: 40px;
            height: 25px;
            object-fit: cover;
            border-radius: 4px;
        }

        .info-mini { display: flex; flex-direction: column; }
        .name { font-size: 0.9rem; font-weight: bold; }
        .viewers { font-size: 0.75rem; color: #aaa; }

        /* ë©€í‹°ë·° ì˜ì—­ */
        #view-grid {
            flex-grow: 1;
            display: grid;
            gap: 5px;
            padding: 5px;
            background: #000;
        }

        /* ì„ íƒ ì¸ì›ìˆ˜ì— ë”°ë¥¸ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ì¡°ì ˆ */
        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3, .grid-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .grid-5, .grid-6 { grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; }

        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .no-data {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
        }
    </style>
</head>
<body>

    <div id="live-selector">
        <span style="color: var(--accent-color); font-weight: bold; margin-right: 10px;">LIVE NOW ğŸ”´</span>
        <div id="member-list" style="display: flex; gap: 10px;">
            </div>
    </div>

    <div id="view-grid" class="grid-1">
        <div class="no-data">ë°©ì†¡ ì¤‘ì¸ ì§ì›ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
    </div>

    <script>
        let selectedIds = new Set();
        let crewData = [];

        // 1. status.json ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadStatus() {
            try {
                // íŒŒì´ì¬ì´ ìƒì„±í•œ íŒŒì¼ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
                const response = await fetch('status.json');
                crewData = await response.json();
                renderSelector();
            } catch (error) {
                console.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", error);
                document.getElementById('member-list').innerHTML = "JSON ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            }
        }

        // 2. ë°©ì†¡ ì¤‘ì¸ ë©¤ë²„ë§Œ ìƒë‹¨ì— í‘œì‹œ
        function renderSelector() {
            const listEl = document.getElementById('member-list');
            listEl.innerHTML = '';

            const liveMembers = crewData.filter(m => m.is_live);

            if (liveMembers.length === 0) {
                listEl.innerHTML = "<span style='font-size: 0.9rem; color: #888;'>í˜„ì¬ ë°©ì†¡ ì¤‘ì¸ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</span>";
                return;
            }

            liveMembers.forEach(member => {
                const card = document.createElement('div');
                card.className = `member-card ${selectedIds.has(member.id) ? 'active' : ''}`;
                card.onclick = () => toggleStream(member.id);
                
                card.innerHTML = `
                    <img class="thumb-mini" src="${member.thumbnail}" onerror="this.src='https://via.placeholder.com/40x25'">
                    <div class="info-mini">
                        <span class="name">${member.id}</span>
                        <span class="viewers">ğŸ‘¤ ${member.viewers}ëª…</span>
                    </div>
                `;
                listEl.appendChild(card);
            });
        }

        // 3. í´ë¦­ ì‹œ ì„ íƒ/í•´ì œ í† ê¸€
        function toggleStream(id) {
            if (selectedIds.has(id)) {
                selectedIds.delete(id);
            } else {
                selectedIds.add(id);
            }
            renderSelector();
            updateGrid();
        }

        // 4. ì•„ì´í”„ë ˆì„ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
        function updateGrid() {
            const gridEl = document.getElementById('view-grid');
            gridEl.innerHTML = '';

            if (selectedIds.size === 0) {
                gridEl.innerHTML = '<div class="no-data">ë°©ì†¡ ì¤‘ì¸ ì§ì›ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>';
                return;
            }

            // ì¸ì›ìˆ˜ì— ë§ì¶° ê·¸ë¦¬ë“œ í´ë˜ìŠ¤ ë³€ê²½
            const count = selectedIds.size;
            gridEl.className = count >= 5 ? 'grid-5' : count >= 3 ? 'grid-3' : count === 2 ? 'grid-2' : 'grid-1';

            selectedIds.forEach(id => {
                const container = document.createElement('div');
                container.className = 'video-container';
                
                // SOOP ì„ë² ë“œ URLì€ play.soop.nm/embed/ì•„ì´ë”” í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
                container.innerHTML = `
                    <iframe 
                        src="https://play.soop.nm/embed/${id}" 
                        allowfullscreen>
                    </iframe>
                `;
                gridEl.appendChild(container);
            });
        }

        // ì´ˆê¸° ì‹¤í–‰
        loadStatus();
        // 1ë¶„ë§ˆë‹¤ ìƒíƒœ ìë™ ê°±ì‹ 
        setInterval(loadStatus, 60000);
    </script>
</body>
</html>