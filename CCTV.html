<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ë˜ìƒì‚¬ LIVE ë©€í‹°ë·°</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • */
        :root {
            --bg-dark: #0f0f0f;
            --card-bg: #1e1e1e;
            --accent-green: #00ffa3;
            --text-white: #ffffff;
            --text-gray: #aaaaaa;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-white);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* 1. ìƒë‹¨ ì„ íƒ ë°” */
        header {
            background-color: var(--card-bg);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 2px solid #333;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .live-dot {
            width: 10px; height: 10px;
            background-color: #ff4d4d;
            border-radius: 50%;
            display: inline-block;
            animation: blink 1.5s infinite;
        }

        @keyframes blink { 50% { opacity: 0.3; } }

        #member-list {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .member-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #2a2a2a;
            border: 2px solid transparent;
            padding: 6px 14px;
            border-radius: 30px;
            cursor: pointer;
            transition: 0.2s all ease;
            white-space: nowrap;
        }

        .member-btn:hover { background: #3a3a3a; }
        .member-btn.active {
            border-color: var(--accent-green);
            background: #1a3a2a;
        }

        .member-btn img {
            width: 32px; height: 20px;
            object-fit: cover;
            border-radius: 4px;
        }

        .member-info { font-size: 0.85rem; font-weight: 600; }
        .viewer-count { font-size: 0.7rem; color: var(--text-gray); }

        /* 2. ë©€í‹°ë·° ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        #view-grid {
            flex-grow: 1;
            display: grid;
            gap: 5px;
            padding: 5px;
            background-color: #000;
        }

        /* ì¸ì›ìˆ˜ì— ë”°ë¥¸ ë™ì  ê·¸ë¦¬ë“œ í´ë˜ìŠ¤ */
        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3, .grid-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .grid-5, .grid-6 { grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; }

        .video-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            background: #121212;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .empty-msg {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #555;
            text-align: center;
        }
    </style>
</head>
<body>

    <header>
        <div style="display: flex; align-items: center; gap: 8px; min-width: 110px;">
            <span class="live-dot"></span>
            <strong style="font-size: 0.9rem;">LIVE NOW</strong>
        </div>
        <div id="member-list">
            </div>
    </header>

    <div id="view-grid" class="grid-1">
        <div class="empty-msg">
            <h2>ê³ ë˜ìƒì‚¬ ë©€í‹°ë·°</h2>
            <p>ìƒë‹¨ì—ì„œ ë°©ì†¡ ì¤‘ì¸ ì§ì›ì„ ì„ íƒí•˜ì—¬ ì‹œì²­í•˜ì„¸ìš”!</p>
        </div>
    </div>

    <script>
        let selectedMembers = new Set();
        let statusData = [];

        // 1. JSON íŒŒì¼ ë¡œë“œ (íŒŒì´ì¬ì´ ìƒì„±í•œ status.json)
        async function fetchStatus() {
            try {
                const response = await fetch('status.json');
                if (!response.ok) throw new Error('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                statusData = await response.json();
                renderSelector();
            } catch (err) {
                console.error("Error:", err);
                document.getElementById('member-list').innerHTML = 
                    '<span style="color:#666; font-size:0.8rem;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì„œë²„ í™•ì¸ í•„ìš”)</span>';
            }
        }

        // 2. ìƒë‹¨ ë²„íŠ¼ ë Œë”ë§ (is_liveê°€ trueì¸ ì§ì›ë§Œ)
        function renderSelector() {
            const listContainer = document.getElementById('member-list');
            listContainer.innerHTML = '';

            const liveOnes = statusData.filter(m => m.is_live);

            if (liveOnes.length === 0) {
                listContainer.innerHTML = '<span style="color:#666;">í˜„ì¬ ë°©ì†¡ ì¤‘ì¸ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</span>';
                return;
            }

            liveOnes.forEach(member => {
                const btn = document.createElement('div');
                btn.className = `member-btn ${selectedMembers.has(member.id) ? 'active' : ''}`;
                btn.onclick = () => toggleView(member.id);
                
                btn.innerHTML = `
                    <img src="${member.thumbnail}" onerror="this.src='https://via.placeholder.com/32x20?text=NO'">
                    <div class="member-info">
                        <div>${member.id}</div>
                        <div class="viewer-count">ğŸ‘¤ ${member.viewers.toLocaleString()}</div>
                    </div>
                `;
                listContainer.appendChild(btn);
            });
        }

        // 3. ë©€í‹°ë·° í† ê¸€ ê¸°ëŠ¥
        function toggleView(id) {
            if (selectedMembers.has(id)) {
                selectedMembers.delete(id);
            } else {
                selectedMembers.add(id);
            }
            renderSelector();
            updateGrid();
        }

        // 4. ì•„ì´í”„ë ˆì„ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸ (SOOP ì •ì‹ ì£¼ì†Œ ì‚¬ìš©)
        function updateGrid() {
            const gridContainer = document.getElementById('view-grid');
            gridContainer.innerHTML = '';

            const count = selectedMembers.size;
            if (count === 0) {
                gridContainer.innerHTML = '<div class="empty-msg"><p>ì„ íƒëœ ë°©ì†¡ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }

            // ì¸ì›ìˆ˜ì— ë§ì¶° ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ì„¤ì •
            gridContainer.className = 
                count >= 5 ? 'grid-5' : 
                count >= 3 ? 'grid-3' : 
                count === 2 ? 'grid-2' : 'grid-1';

            selectedMembers.forEach(id => {
                const wrapper = document.createElement('div');
                wrapper.className = 'video-wrapper';
                
                // SOOP ê³µì‹ ì„ë² ë“œ ì£¼ì†Œ: https://play.sooplive.co.kr/{ì•„ì´ë””}/embed
                wrapper.innerHTML = `
                    <iframe 
                        src="https://play.sooplive.co.kr/${id}/embed" 
                        allowfullscreen 
                        scrolling="no">
                    </iframe>
                `;
                gridContainer.appendChild(wrapper);
            });
        }

        // ì´ˆê¸° ë¡œë“œ ë° 30ì´ˆë§ˆë‹¤ ê°±ì‹  (ìë™ ì—…ë°ì´íŠ¸)
        fetchStatus();
        setInterval(fetchStatus, 30000); 
    </script>
</body>
</html>
